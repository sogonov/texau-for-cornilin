\begin{sloppypar} % помогает в кириллическом документе выровнять текст по краям
\newpage % Так добавляется  новая страница

\section{Структура устройства} %Объявили начало раздела
В данной лабораторной работе создается устройство, реагирующее на нажатие клавиш и затем в зависимости от клавиши увеличивающее или
уменьшающее значение счетчика. Значение счетчика должно отображаться на семисегментном индикаторе, используя принцип динамической индикации. Структурная схема устройства представлена на рисунке \ref{ris:Figures/2022-10-10_22-59-24.png}. На ней показаны основные соединения блоков, за исключением схемы сброса, необходимой при работе с последовательными схемами.


\imgh{160.5mm}{Figures/2022-10-10_22-59-24.png}{Структурная схема} 


При проектировании данного устройства использовался принцип иерархического проектирования, где каждый из модулей описывается отдельным описанием устройства на языке VHDL. 

Делитель частоты DIVIDER обеспечивает тактовые импульсы для модулей устранения дребезга и системы индикации. Он синхронизируется системным тактовым сигналом (100 МГц), подаваемым внешним осциллятором. 


Модуль устранения дребезга DEBOUNCE подавляет паразитные импульсы, которые могут быть вызваны механическими контактами (кнопками). Это особая схема, синхронизируемая сигналом с выхода делителя частоты DIVIDER. Кнопки и ползунковые переключатели не являются частью ПЛИС, они реализованы на отладочной плате.  


На реверсивный счетчик BIDIRECTIONAL COUNTER поступают импульсы от модуля устранения дребезга. Реверсивный счётчик увеличивает или уменьшает значение в зависимости от положения ползункового переключателя.

FSM модуль представляет собой автомат с конечным числом состояний (на англ. finite state machine – FSM) для переключения индикаторов и манипуляции адресами в бесконечном цикле. Мы используем автомат Мура с четырьмя состояниями (S0, S1, S2, S3) и переключением между ними. В каждом состоянии FSM устанавливает определенный адрес для мультиплексора и включает соответствующий индикатор. 

MUX(мультиплексор) занимается динамической индикацией: на вход получая данные со счетчика и с модуля FSM. FSM включает один из индикаторов, передавая его номер мультиплексору, и мультиплексор выводит соответствующий разряд числа, полученного со счетчика.


Модуль hexled преобразует число, выданное мультиплексором, в последовательность бит, дающих на индикаторе соответствующую цифру.



\section{Создание устройства} %Объявили начало раздела
\subsection{Создание схемы устройства} %Объявили начало раздела
По методике, описанной в методических указаниях к лабораторной работе, в программном пакете Vivado v2016.4 была создана схема, объединяющая ранее описанные модули. После того, как все модули созданы, необходимо соединить их в единую схему. Полученная схема изображена на рисунке \ref{ris:Figures/sch.png}


\imgh{160.5mm}{Figures/sch.png}{Схема устройства} 

\subsection{Симуляция} %Объявили начало раздела

Далее был создан файл симуляции «simm» подобно тому, как делалось это в I части лабораторной работы. Для того, чтобы просимулировать поведение устройства при всех возможных событиях, стоит немного изменить файл симуляции, приведенный в методических указаниях. Он примет вид:
\inputminted[
% frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
% linenos%нумерация строк
]
{VHDL}%язык программирования
{SIMM.vhd}%файл с кодом(должен лежать в папке проекта)


Были получены временные диаграммы, показанные на рисунках \ref{ris:Figures/reset.png}, \ref{ris:Figures/updown1.png},  \ref{ris:Figures/updown0.png}, \ref{ris:Figures/updown.png}.

\imghh{160.5mm}{Figures/reset.png}{Cброс в начальный момент времени} 
\imghh{160.5mm}{Figures/updown1.png}{Увеличение значения счетчика, при updown='1'} 
\imghh{160.5mm}{Figures/updown0.png}{Уменьшение значения счетчика, при updown='0'} 
\imghh{160.5mm}{Figures/updown.png}{Более наглядная иллюстрация} 



Таким образом, с помощью вышеописанного файла симуляции была проверена работоспособность устройства. Временные диаграммы показывают, что требуемые функции работают.

\subsection{Синтез} %Объявили начало раздела
В этом разделе необходимо задать временные ограничения, создать асинхронные группы, и прочие манипуляции, описанные в методических указаниях, добиваясь отсутствия ошибок, связанных с THS  и TNS. 

В результате синтеза, после исправления была получена следующая схема и сводка по времени(рисунок \ref{ris:Figures/synth.png})
Так же на этом этапе необходимо указать внешние порты ввода-вывода для размещения схемы внутри ПЛИС. Сделать это нужно вручную.

\imgh{160.5mm}{Figures/port.png}{Расположение портов ввода-вывода} 
\begin{landscape}
\imgh{250.5mm}{Figures/synth.png}{Синтезированная схема и сводка по времени} 
% текст в альбомной ориентации
% (таблица, рисунок, схема и т. п.)
\end{landscape}



\section{Реализация} %Объявили начало раздела
Следующий шаг разработки устройства – это реализация.
После завершения процесса реализации нужно проверить выполнение временных ограничений (Report Timing Summary)(рисунок \ref{ris:Figures/timing.png})
\imghh{160.5mm}{Figures/timing.png}{временная сводка после реализации} 
\section{Программирование ПЛИС} %Объявили начало раздела

Для программирования ПЛИС нужно выбрать Generate Bitstream на левой панели (Flow Navigator), а после завершения процесса открыть Hardware Manager, подключить кабель USB к отладочной плате (разъем PROG) и затем к компьютеру. Включить плату (переключатель POWER на плате), а также проверить правильность установки перемычек JP1 и JP2. 

 
В окне Hardware Manager необходимо выбрать ''Open Target'', а затем ''Auto Connect'' Если соединение будет успешным, надпись ''unconnected'' сменится на имя платы, появится кнопка ''Program Device''. При нажатиии на нее нужно выбрать отладочную плату, а затем файл с битовым потоком (с расширением
.bit) -- ''Bitstream file'' . Нажать ''Program''.

После завершения программирования устройства была произведена проверка его работоспособности, в результате которой было выяснено, что устройство работает корректно. Функции, возложенные на кнопки reset, D\_IN и updown правильно работают.
\section{ОТВЕТЫ НА ВОПРОСЫ ДЛЯ САМОПРОВЕРКИ} %Объявили начало раздела


\textit {1. Что такое иерархическое проектирование и в чем его преимущества?}

Иерархические структуры могут упростить процесс разработки и разделить его между несколькими разработчиками. Несколько членов команды
могут работать одновременно и независимо над разными частями устройства. Каждая часть может быть отлажена по отдельности и стать частью более сложной схемы.

\textit {2. Пользуясь рисунком \ref{ris:Figures/2022-10-10_22-59-24.png}, поясните работу разрабатываемого устройства.}


Данный вопрос был прояснен в тексте работы выше.

\textit {3. Как работает семисегментный индикатор? Что такое статическая и
динамическая индикация?}



Индикатор состоит из семи отдельно управляемых (подсвечиваемых светодиодом) элементов - сегментов. Эти элементы позволяют отобразить любую цифру 0..9, а также некоторые другие символы, например: '-', 'A', 'b', 'C', 'd', 'E', 'F' и другие. Это даёт возможность использовать индикатор для вывода положительных и отрицательных десятичных и шестнадцатеричных чисел и даже текстовых сообщений. Обычно индикатор имеет также восьмой элемент - точку, используемую при отображении чисел с десятичной точкой. 

При статической индикации выводы индикатора подключены к устройству независимо друг от друга и информация на них выводится постоянно. Этот способ управления проще динамического, но без использования дополнительных элементов, подключить многоразрядный семисегментный индикатор к устройству будет проблематично - может не хватить выводов.

Динамическая индикация подразумевает поочередное зажигание разрядов индикатора с частотой, не воспринимаемой человеческим глазом. Схема подключения индикатора в этом случае на порядок экономичнее благодаря тому, что одинаковые сегменты разрядов индикатора объединены.

В нашем случае использовался принцип динамической индикации.

\textit {4. Для чего необходим модуль устранения дребезга?}

Дребезг контактов это явление, происходящее в электромеханических коммутационных устройствах и аппаратах, длящееся некоторое время после замыкания электрических контактов. После замыкания происходят многократные неконтролируемые замыкания и размыкания контактов за счёт упругости материалов и деталей контактной системы - некоторое время контакты отскакивают друг от друга при соударениях, размыкая и замыкая электрическую цепь. 

Модуль устранения дребезга призван избавить дальнейшие цепи от этих многократных замыканий и размыканий, выдавая на выходе чистое нажатие.

\inputminted[
frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
% linenos%нумерация строк
]
{VHDL}%язык программирования
{debounce.vhd}%файл с кодом(должен лежать в папке проекта)

\imghh{160.5mm}{Figures/deb.png}{временная диаграмма модуля устранения дребезга -1}
\imghh{160.5mm}{Figures/deb1.png}{временная диаграмма модуля устранения дребезга -2}

\textit {5. Объясните работу делителя частоты. Как рассчитать частоту делителя?}

\inputminted[
% frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
linenos%нумерация строк
]
{VHDL}%язык программирования
{divider.vhd}%файл с кодом(должен лежать в папке проекта)
Наглядно работу данного описания можно объяснить, синтезировав его при разных значениях переменной Nd. Соответствующие рисунки будут ниже. Изменим строки 42 и 60-61 из вышеописанного кода:


\begin{minted} [
% frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
% linenos%нумерация строк
]{VHDL}
------------------------
generic (Nd : integer := 2);--объявление переменной Nd. 
-------------------------
Clk_deb<=V(2);--подключение выходов к необходимой ступени делителя
Clk_led<=V(1);
---------------------
\end{minted}

Nd - переменная, хранящая в себе количество итераций для конструкции generate. Две другие строки отвечают за расположение подключения выводов Clk\_deb и Clk\_led.


Если синтезировать описание с такими измененными значениями, получим простейший делитель, который делит на четыре (рисунок \ref{ris:Figures/div2.png}). Причем вывод Clk\_deb делится на 4, а Clk\_led делится на два, так как подключены к выходам разных триггеров.

\imghh{160.5mm}{Figures/div2.png}{делитель в минимальной комплектации} 


Снова изменив эти коэфициенты: 


\begin{minted} [
% frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
% linenos%нумерация строк
]{VHDL}
------------------------
generic (Nd : integer := 3);--объявление переменной Nd. 
-------------------------
Clk_deb<=V(3);--подключение выходов к необходимой ступени делителя
Clk_led<=V(1);
---------------------
\end{minted}

Если синтезировать описание с такими измененными значениями, получим делитель, который делит на восемь (рисунок \ref{ris:Figures/div2.png}). Причем вывод Clk\_deb делится на 8, а Clk\_led все еще делится на два.

\imghh{160.5mm}{Figures/div3.png}{Clk\_deb делим на 8, Clk\_led делим на 2} 

Аналогично получаем такую схему

\imghh{160.5mm}{Figures/div3_2.png}{Clk\_deb делим на 8, Clk\_led делим на 4} 

Если вернуть значения на изначальные, будет синтезирована такая схема(фрагмент показан на рисунке \ref{ris:Figures/div3_22.png}). Видно, что синтезировано 24 пары триггеров и элементов ''и'', выводы Clk\_deb и Clk\_led подключены соответственно к 18 и 19 ступени.

\imghh{160.5mm}{Figures/div3_22.png}{Схема деления на $2^{18} $ и $2^{19}$} 


\textit {6. Опишите строки кода в файле Rcounter.vhd.}
\inputminted[
% frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
% linenos%нумерация строк
]
{VHDL}%язык программирования
{Rcounter.vhd}%файл с кодом(должен лежать в папке проекта)


\textit {7. Объясните работу модуля FSM.}

\inputminted[
% frame=lines,%линия сверху и снизу блока кода
% framesep=15mm, % отступ между линией и кодом
baselinestretch=1, %интервал междустрочный
% bgcolor=LightGray, %цвет фона
fontsize=\footnotesize, %размер шрифта
% linenos%нумерация строк
]
{VHDL}%язык программирования
{FSM.vhd}%файл с кодом(должен лежать в папке проекта)

\textit {8. Посмотрите код в файлах divider.vhd и fsm.vhd и скажите, с какой частотой мерцает каждый отдельный семисегментный индикатор.}

Модуль fsm.vhd управляет анодами семисегментных индикаторов и мультиплексором, включающих нужные для индикации катоды. Мерцание индикаторов обуславливается именно переключением напряжения на их анодах, то есть, это зависит только от модуля fsm.vhd

fsm.vhd тактируется сигналом, получаемого из модуля divider.vhd, имеющего частоту 100MHz$/2^{19}$ ≈190,734Hz. Именно с такой частотой переключаются индикаторы.


\textit {9. Прокомментируйте результаты моделирования (рисунок 10 из методических указаний).}

В ходе работы были подробно прокомментированы  результаты моделирования. Рисунок 10 из методических указаний свидетельствует лишь о том, что  сброс происходит, аноды индикатора последовательно переключаются, сигнал D\_in не влияет ни на что, так как updown='0'

\textit {10. Обоснуйте выбор портов ввода/вывода. Почему вы назначали именно эти выводы?}
\imghh{160.5mm}{Figures/port.png}{Расположение портов ввода-вывода}  
Эти выводы назначены были в соответствии со схемой выводов, взятой из даташита на отладочную плату(рисунок \ref{ris:Figures/datash.png})

Конструкцией отладочной платы жестко прописаны порты для тактового сигнала, для катодов и анодов семисегментного индикатора. Переключатель для updown можно было выбрать из 15 доступных на плате, кнопки reset и D\_in можно было выбрать из 5 доступных.

\imghh{160.5mm}{Figures/datash.png}{Фрагмент даташита на отладочную плату}  

\textit {11. Опишите процесс подключения отладочной платы к компьютеру и ее
подготовки к программированию ПЛИС}

Этот процесс был описан в тексте работы выше.


\end{sloppypar}
